<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Padlet to Notion</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div id="app">

    <!-- ── 연결 목록 화면 ───────────────────────────────────────────────── -->
    <div id="listView" class="hidden">
      <header>
        <h1>Padlet → Notion</h1>
      </header>
      <div class="list-body">
        <div class="list-header">저장할 연결 선택</div>
        <div id="connectionList"></div>
        <div id="notPadletHint" class="hint hidden">⚠️ 패들렛 페이지에서 실행해주세요</div>
        <button id="addConnectionBtn" class="btn-secondary">+ 새 연결 추가</button>
      </div>
    </div>

    <!-- ── 저장 실행 화면 ───────────────────────────────────────────────── -->
    <div id="saveView" class="hidden">
      <header class="save-header">
        <button id="backBtn" class="btn-back" title="뒤로">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path d="M11 13.5L6.5 9L11 4.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <span id="saveViewTitle"></span>
        <button id="renameConnBtn" class="btn-icon-sm" title="이름 변경">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M9.5 2.5L11.5 4.5L4.5 11.5H2.5V9.5L9.5 2.5Z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button id="deleteConnBtn" class="btn-icon-danger" title="연결 삭제">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M2.5 3.5H11.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
            <path d="M4.5 3.5V2.5C4.5 2.22 4.72 2 5 2H9C9.28 2 9.5 2.22 9.5 2.5V3.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
            <path d="M10.5 3.5L10 11.5C10 11.78 9.78 12 9.5 12H4.5C4.22 12 4 11.78 4 11.5L3.5 3.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </header>
      <div class="save-body">
        <div id="status" class="status idle">
          <span id="statusIcon"></span>
          <span id="statusText">패들렛을 노션으로 내보내시겠습니까?</span>
        </div>
        <div id="progress" class="hidden">
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
          </div>
          <div id="progressText" class="progress-text">준비 중...</div>
        </div>
        <button id="saveBtn" class="btn-primary">확인</button>
      </div>
    </div>

    <!-- ── 설정 화면 (연결 추가) ─────────────────────────────────────────── -->
    <div id="settingsView" class="hidden">
      <header>
        <h1>Padlet → Notion</h1>
      </header>
      <div class="settings-body">
        <h2>연결 추가</h2>

        <!-- 연결 이름 -->
        <div class="form-group">
          <label for="connNameInput">연결 이름</label>
          <input type="text" id="connNameInput" placeholder="예: 학교 프로젝트">
          <div class="hint">비워두면 워크스페이스 이름으로 자동 설정됩니다</div>
        </div>

        <!-- 인증 방식 -->
        <div class="form-group">
          <label>인증 방식</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="authMode" value="oauth" id="authOAuth">
              <span>Notion 계정 연결 <span class="badge">추천</span></span>
            </label>
            <label class="radio-label">
              <input type="radio" name="authMode" value="token" id="authToken">
              <span>통합 토큰 직접 입력</span>
            </label>
          </div>
        </div>

        <!-- 토큰 입력 (토큰 모드일 때만) -->
        <div id="tokenFields" class="form-group hidden">
          <label for="tokenInput">Notion 통합 토큰</label>
          <input type="password" id="tokenInput" placeholder="ntn_...">
        </div>

        <!-- DB 설정 -->
        <div class="form-group">
          <label>DB 설정</label>
          <div class="radio-group">
            <label class="radio-label" id="createDbLabel">
              <input type="radio" name="dbMode" value="create" id="modeCreate">
              <span>새 DB 자동 생성</span>
            </label>
            <label class="radio-label">
              <input type="radio" name="dbMode" value="connect" id="modeConnect">
              <span>기존 DB 연결</span>
            </label>
          </div>
          <div id="oauthRequired" class="hint hidden">새 DB 생성은 Notion 계정 연결 방식만 지원합니다</div>
        </div>

        <!-- 기존 DB 연결 전용 -->
        <div id="existingDbFields" class="hidden">
          <div class="form-group">
            <label for="padletDbInput">패들렛 DB</label>
            <input type="text" id="padletDbInput" placeholder="32자리 ID 또는 Notion URL">
          </div>
          <div class="form-group">
            <label for="postDbInput">포스트 DB</label>
            <input type="text" id="postDbInput" placeholder="32자리 ID 또는 Notion URL">
          </div>
        </div>

        <div id="settingsError" class="error hidden"></div>

        <div class="btn-row">
          <button id="cancelSettingsBtn" class="btn-secondary">취소</button>
          <button id="saveSettingsBtn" class="btn-primary">연결하기</button>
        </div>
      </div>
    </div>

    <!-- ── 온보딩 화면 ───────────────────────────────────────────────────── -->
    <div id="onboardingView" class="hidden">
      <header>
        <h1>Padlet → Notion</h1>
      </header>
      <div class="onboarding-body">
        <div class="onboarding-icon">
          <svg width="80" height="64" viewBox="0 0 80 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Padlet 페이지 -->
            <rect x="2" y="8" width="26" height="48" rx="5" fill="#FFF0EC" stroke="#FF6B35" stroke-width="1.5"/>
            <rect x="8" y="17" width="14" height="2.5" rx="1.25" fill="#FF6B35"/>
            <rect x="8" y="24" width="14" height="2" rx="1" fill="#FF6B35" opacity="0.55"/>
            <rect x="8" y="30" width="10" height="2" rx="1" fill="#FF6B35" opacity="0.35"/>
            <rect x="8" y="36" width="14" height="2" rx="1" fill="#FF6B35" opacity="0.55"/>
            <rect x="8" y="42" width="8" height="2" rx="1" fill="#FF6B35" opacity="0.35"/>
            <!-- 화살표 -->
            <path d="M32 32H48" stroke="#CBD5E1" stroke-width="2" stroke-linecap="round"/>
            <path d="M44 27.5L49 32L44 36.5" stroke="#CBD5E1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <!-- Notion 페이지 -->
            <rect x="52" y="8" width="26" height="48" rx="5" fill="#F8F8F8" stroke="#374151" stroke-width="1.5"/>
            <rect x="58" y="17" width="14" height="2.5" rx="1.25" fill="#374151"/>
            <rect x="58" y="24" width="14" height="2" rx="1" fill="#374151" opacity="0.45"/>
            <rect x="58" y="30" width="10" height="2" rx="1" fill="#374151" opacity="0.3"/>
            <rect x="58" y="36" width="14" height="2" rx="1" fill="#374151" opacity="0.45"/>
            <rect x="58" y="42" width="8" height="2" rx="1" fill="#374151" opacity="0.3"/>
          </svg>
        </div>
        <h2>처음 설정</h2>
        <p>Notion 계정을 연결하면<br>DB를 자동으로 만들어 드려요</p>
        <button id="oauthStartBtn" class="btn-primary">Notion 계정 연결</button>
        <div id="onboardingError" class="error hidden"></div>

        <!-- OAuth 완료 후: 이름 설정 단계 -->
        <div id="onboardingNameSection" class="hidden">
          <div class="form-group">
            <label for="onboardingNameInput">연결 이름</label>
            <input type="text" id="onboardingNameInput" placeholder="연결 이름을 입력하세요">
          </div>
          <button id="onboardingConfirmBtn" class="btn-primary">저장하고 시작</button>
        </div>

        <button id="goToSettingsBtn" class="btn-text">수동으로 설정하기</button>
      </div>
    </div>

  </div>
  <script src="popup.js"></script>
</body>
</html>
